# 代码规范（C）
贡献者：何文轩
## 引言
> - 代码规范是软件开发中制定的一系列规则和标准，旨在统一代码风格和结构。遵守代码规范对于团队开发具有以下重要性：
> - 提高代码质量：统一的代码风格和规范有助于减少错误和漏洞，提升软件的安全性和稳定性。 
> - 降低维护成本：规范化的代码更易于修改和扩展，减少维护工作量，降低长期维护成本。 
> - 确保可读性和一致性：统一的编码风格使代码结构清晰，易于阅读和理解，便于快速定位问题和分享知识。 
> - 总之，遵循代码规范对于提升代码质量、促进团队协作、降低维护成本以及确保代码可读性和一致性至关重要。

本文参考[谷歌代码规范](https://zh-google-styleguide.readthedocs.io/en/latest/contents.html)，并作出部分修改

## 头文件规范
### 1. 只包含必要的头文件     
例如如下代码，uart.h就是是一个多余的头文件，这不会导致编译的出错，但我们并不需要使用uart.h中声明的接口，因此这种行为会导致编译效率的降低。如果此时uart.h中还包含了其它文件，那么全部都会在预处理时展开到test.c中。当一个项目的代码量很大时，由于效率地下而多占用的时间就无法忽视了。再说了，不需要的你include它干嘛？想要长长的编译时间？
``` c
#include <test.h>
#include <stdio.h>
#include <uart.h>

?void test ()
{
   printf ("hello world!\n");
}
```
### 2. 头文件主要包含内容
数据类型声明、函数声明、宏定义、全局变量声明等
### 3. include按顺序引用
例如如下格式（包括空行也是）：
``` c
#include "this_is_a_header.h" //关联头文件

#include <stdio.h> // c库文件
#include <string.h>

#include <string> // c++库文件

#include "glog.h" // 其他库的头文件

#include "same_project_header.h" // 本项目中的其他头文件
```
### 4. 头文件保护
这个学过c语言，应该懂得都懂了，按如下格式执行，注意全部是大写，开头结尾都是两根下划线
``` c
#ifndef __CHASSIS_H__
#define __CHASSIS_H__
......
#endif

```
### 5. 结构体
如果结构体是多个源文件共享的数据结构，通常将其定义在头文件(.h)中。这样可以在多个源文件中通过包含头文件来使用该结构体。但如果结构体只在当前源文件中使用，可以将其定义在源文件的顶部。这种方式可以避免不必要的头文件依赖，但会降低代码的复用性。故建议全部定义于头文件中

## 格式规范
### 1. 所有Tab全部使用4个空格替代
尽量不要使用Tab进行缩进，请敲击四下空格键,不然有其他人的Tab缩进与你的设置不同，在他那里你的项目格式全是错误的
### 2. 把左括号写到条件括号右边（函数除外）
例如：   
``` c
if(条件){
    函数体
}else if(条件){
    函数体
}else {
    函数体
}
```
### 3. 在运算符两边都要加上空格，每一个逗号后面也要加上空格
### 4. 如果一个函数中的参数过多，请进行分行，例如：
``` c
void PID_init(PID_struct_t *PID,
              float kp,
              float ki,
              float kd,
              float kf,
              float i_max,
              float out_max)
{
    函数体
}
```

## 命名规范
所有命名必须让人看一眼就知道是干嘛的，不准使用拼音，请使用英文,尤其不准使用aaa这种莫名其妙的东西，尽可能使用描述性的命名, 别心疼空间, 毕竟相比之下让代码易于新读者理解更重要. 不要用只有项目开发者能理解的缩写, 也不要通过砍掉几个字母来缩写单词。

### 文件
下划线命名法（Snake_Case）：函数名全部使用小写字母，单词之间以下划线连接。例如：chassis_task,gimbal_task。注意加前缀表示该文件在工程中的作用。

### 结构体命名
结构体的每个单词首字母均大写, 不包含下划线。例如：ChassisSpeed

### 函数
命名时注意动词的使用
比如我们需要从数据库中获取用户信息，函数的名称可以是userInfo，user或者fetchUser，但推荐使用含有动词的命名 getUser。   
小驼峰式（lowerCamelCase）：函数名以小写字母开头，后续单词的首字母大写,中间不加下划线。这里我们要求把函数返回值类型写在函数名开头，例如底盘解算函数就写成vChassisCalculate，表示函数返回值为void类型。具体对应关系为：   
| 返回值类型 | 字母   | 
| :----:    | :----: |
| void      | v      |
| int       | i      |
| float     | f      |
| double    | d      |
| char      | c      |
| struct    | s      |
| enum      | e      |
| bool      | b      |

### 全局变量
变量 (包括函数参数) 和数据成员名一律小写, 单词之间用下划线连接。
### 常值命名
声明为 constexpr 或 const 的变量, 或在程序运行期间其值始终保持不变的, 命名时以 “k” 开头, 大小写混合. 例如:
```c
const int kDaysInAWeek = 7;
```
### 临时变量
临时变量以要加一个前缀，例如cnt_delay，就表示用计数延时代替Delay的计数临时变量，前缀和作用对应关系为：
| 临时变量作用类型 | 字母   | 
| :----:          | :----:  |
| 计数            | cnt    |
| 状态            | state  |
| 临时            | tmp    |
| 其他            | 英文简写|
### 宏变量
常量值所有都大写，常量命名都使用全大写的名称，并用下划线分割所有单词例如：
```c
#define DAYS_IN_A_YEAR 365;
```

## 函数规范
### 1. 函数深度嵌套
有些程序需要使用到无数次的嵌套循环，看着看着就晕了，这时可以将所有循环提取到单独的函数中。
假设有一个包含两层嵌套的数组，想要拿到最后一个数组的值？一般情况下开发者都会使用嵌套循环，但不是最佳的办法。可以尝试使用函数的反复调用来完成操作执行相同操作的，这样一来代码重复性更小，更易于阅读、重用性高。
### 2. 避免创建大函数
当一个函数或一个类需要实现的功能太多时，建议将其分成多个小的函数。也易于后续修改，但是也不能分太细，分太细反而会让人不好找。

## 注释规范
注释的作用是让人更容易理解代码，所以注释的内容应该是对代码的解释，而不是对代码的重复
例如：
``` c
void swap(int *a, int *b){ // 交换两个数
    int temp = *a;      // 存下 a 的值
    *a = *b;            // 将 b 的值赋给 a
    *b = temp;          // 将 a 的值赋给 b
}
```
这种代码注释就是纯多余
### 文件注释
```c
 /**
 * @file 函数存放文件名
 * @author 作者
 * @version 版本号
 * @date 日期
 * @note 注意事项
 */
```

### 函数注释
``` c
 /**
 * @brief 函数作用
 * @param 传参
 * @return 返回值含义
 * @note 注意事项（比如哪些东西是要修改的）
 * @par 示例代码（与note配合使用）
 */
```
### 计算注释
+ 对全局变量、常量或难以理解的变量，添加注释说明其用途和取值范围。
+ 在条件判断、循环等控制结构前，添加注释说明其作用和判断条件，特别是复杂的嵌套结构。
+ 对于异常处理、错误捕获、特殊输入等情况，添加注释说明处理方式和原因。
+ 对于复杂或不直观的代码逻辑、算法，添加注释以解释其工作原理，帮助他人理解。

## 项目架构
项目总文件下，Cubemx生成的格式保持不变，自己创建的文件全部存于User_File,可以有自己的风格，但是在readme里面要详细说明，具体推荐架构为：
![](pics/ProjectStructure.png)
该架构参考于中科大robowalk战队，并做了部分调整